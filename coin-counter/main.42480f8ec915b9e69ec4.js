(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var s;t.g.importScripts&&(s=t.g.location+"");var i=t.g.document;if(!s&&i&&(i.currentScript&&"SCRIPT"===i.currentScript.tagName.toUpperCase()&&(s=i.currentScript.src),!s)){var e=i.getElementsByTagName("script");if(e.length)for(var h=e.length-1;h>-1&&(!s||!/^http(s?):/.test(s));)s=e[h--].src}if(!s)throw new Error("Automatic publicPath is not supported in this browser");s=s.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=s})();const s=t.p+"assets/images/canadian-coins.png",i={nickel:{sWidth:180,sHeight:180,sxFront:0,sxBack:180,sy:0},dime:{sWidth:156,sHeight:156,sxFront:0,sxBack:156,sy:180},quarter:{sWidth:200,sHeight:200,sxFront:0,sxBack:200,sy:336},loonie:{sWidth:220,sHeight:220,sxFront:0,sxBack:220,sy:536},toonie:{sWidth:232,sHeight:232,sxFront:0,sxBack:232,sy:756}};function e(t){const s=document.getElementById("user-count");s&&(s.textContent=t)}function h(t,s=!1){const i=document.getElementById("actual-count");i&&(i.textContent=t,s?i.classList.remove("hidden"):i.classList.add("hidden"))}class o{constructor(t,s,i,e,h){switch(this.p=t,this.x=s,this.y=i,this.prevX=s,this.prevY=i,this.type=e,this.rotation=t.random(0,t.TWO_PI),this.dragging=!1,this.coinSpriteData=h,this.isFront=t.random()>.5,e){case"toonie":this.radius=59,this.value=2;break;case"loonie":this.radius=55.5,this.value=1;break;case"quarter":this.radius=50,this.value=.25;break;case"dime":this.radius=38,this.value=.1;break;case"nickel":this.radius=44.5,this.value=.05;break;default:this.radius=20,this.value=0}this.visualRadius=this.radius,this.radius*=.98,this.mass=Math.PI*this.radius*this.radius*.01,this.offsetX=0,this.offsetY=0,this.vel=t.createVector(0,0),this.lastUpdateTime=t.millis()}flip(){this.isFront=!this.isFront}draw(){const t=this.p;if(t.push(),t.translate(this.x,this.y),t.rotate(this.rotation),t.imageMode(t.CENTER),this.coinSpriteData&&this.coinSpriteData.isReady&&this.coinSpriteData.image&&this.coinSpriteData.spriteDefinitions){const{image:s,spriteDefinitions:i}=this.coinSpriteData,e=i[this.type];if(!e)return console.error(`Sprite definition not found for coin type: ${this.type}`),this.drawFallback(),void t.pop();const h=this.isFront?e.sxFront:e.sxBack,o=e.sy,a=e.sWidth,n=e.sHeight;t.image(s,0,0,2*this.visualRadius,2*this.visualRadius,h,o,a,n)}else this.drawFallback();t.pop()}drawFallback(){const t=this.p;t.fill(200,200,200),t.ellipse(0,0,2*this.visualRadius),t.fill(0),t.textAlign(t.CENTER,t.CENTER),t.text(this.type,0,0)}isMouseOver(t,s){const i=t-this.x,e=s-this.y;return i*i+e*e<=this.radius*this.radius}startDrag(t,s){this.dragging=!0,this.offsetX=this.x-t,this.offsetY=this.y-s,this.lastUpdateTime=this.p.millis()}stopDrag(){this.dragging=!1}updateDrag(t,s,i,e,h,o){if(this.dragging){this.prevX=this.x,this.prevY=this.y;const a=this.p.millis(),n=(a-this.lastUpdateTime)/1e3;if(this.x=Math.max(i+this.radius,Math.min(e-this.radius,t+this.offsetX)),this.y=Math.max(h+this.radius,Math.min(o-this.radius,s+this.offsetY)),n>0){let t=(this.x-this.prevX)/n,s=(this.y-this.prevY)/n;const i=.05;t*=i,s*=i,this.vel.set(t,s);const e=5;this.vel.limit(e)}this.lastUpdateTime=a}}applyForce(t,s){this.vel.x+=t/this.mass,this.vel.y+=s/this.mass}update(t,s,i,e){if(!this.dragging){this.prevX=this.x,this.prevY=this.y,this.x+=this.vel.x,this.y+=this.vel.y;const h=this.vel.mag();if(h>0){const t=.1;if(h<t)this.vel.set(0,0);else{const s=this.vel.x/h*t,i=this.vel.y/h*t;this.vel.x-=s,this.vel.y-=i}}this.x<t+this.radius?(this.x=t+this.radius,this.vel.x*=-.7):this.x>s-this.radius&&(this.x=s-this.radius,this.vel.x*=-.7),this.y<i+this.radius?(this.y=i+this.radius,this.vel.y*=-.7):this.y>e-this.radius&&(this.y=e-this.radius,this.vel.y*=-.7)}}}function a(t,s,i){return Math.max(s,Math.min(i,t))}function n(t){return`$${t.toFixed(2)}`}function r(t,s){return t=Math.ceil(t),s=Math.floor(s),Math.floor(Math.random()*(s-t+1))+t}function d(t,s){const i=s.x-t.x,e=s.y-t.y,h=Math.sqrt(i*i+e*e);if(0===h)return s.x+=.1,{circle1:t,circle2:s};const o=t.radius+s.radius-h;if(o<=0)return{circle1:t,circle2:s};const a=o*i/h,n=o*e/h;return{circle1:{...t,x:t.x-a/2,y:t.y-n/2},circle2:{...s,x:s.x+a/2,y:s.y+n/2}}}class l{constructor(t,s){this.p=t,this.coinSpriteData=s,this.coins=[],this.draggedCoin=null,this.totalValue=0,this.userGuess=0,this.gameEnded=!1,this.debugMode=!1,this.minCoins=5,this.maxCoins=12,this.init(),this.setupEventListeners()}init(){this.coins=[],this.gameEnded=!1,this.totalValue=0,e("$0.00"),h("$0.00",!1),function(){const t=document.getElementById("user-count-text");t&&(t.value="")}();const t=r(this.minCoins,this.maxCoins),s=["toonie","loonie","quarter","dime","nickel"];for(let i=0;i<t;i++){const t=s[r(0,s.length-1)];let i,e,h=!1,a=0;const n=100;for(;!h&&a<n;){const s=50;i=r(s,this.p.width-s),e=r(s,this.p.height-s);const n=new o(this.p,i,e,t,this.coinSpriteData);h=this.coins.every((t=>{const s=t.x-n.x,i=t.y-n.y;return Math.sqrt(s*s+i*i)>t.radius+n.radius})),a++}if(h){const s=new o(this.p,i,e,t,this.coinSpriteData);this.coins.push(s),this.totalValue+=s.value}}console.log(`Game started with ${this.coins.length} coins. Total value: ${n(this.totalValue)}`)}setupEventListeners(){const t=document.getElementById("submit-btn"),s=document.getElementById("new-game-btn"),i=document.getElementById("debug-btn"),e=document.getElementById("user-count-text");t&&t.addEventListener("click",(()=>{this.checkAnswer()})),s&&s.addEventListener("click",(()=>{this.init()})),i?i.addEventListener("click",(()=>{this.toggleDebugMode()})):this.createDebugButton(),e&&e.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),this.checkAnswer())}))}createDebugButton(){const t=document.querySelector(".buttons");if(t){const s=document.createElement("button");s.id="debug-btn",s.textContent="Debug Mode",s.addEventListener("click",(()=>{this.toggleDebugMode()})),t.appendChild(s)}}toggleDebugMode(){this.debugMode=!this.debugMode,console.log("Debug mode: "+(this.debugMode?"ON":"OFF"));const t=document.getElementById("debug-btn");t&&(t.textContent=this.debugMode?"Hide Debug":"Debug Mode")}handleCanvasResize(t,s){for(const i of this.coins)i.x=a(i.x,i.radius,t-i.radius),i.y=a(i.y,i.radius,s-i.radius)}handleMousePressed(){if(!this.gameEnded)for(let t=this.coins.length-1;t>=0;t--){const s=this.coins[t];if(s.isMouseOver(this.p.mouseX,this.p.mouseY)){this.coins.splice(t,1),this.coins.push(s),s.startDrag(this.p.mouseX,this.p.mouseY),this.draggedCoin=s;break}}}handleMouseReleased(){this.draggedCoin&&(this.draggedCoin.stopDrag(),this.draggedCoin=null)}update(){this.draggedCoin&&this.draggedCoin.updateDrag(this.p.mouseX,this.p.mouseY,0,this.p.width,0,this.p.height);for(let t=0;t<this.coins.length;t++)for(let s=t+1;s<this.coins.length;s++){const i=this.coins[t],e=this.coins[s],h=e.x-i.x,o=e.y-i.y,a=Math.sqrt(h*h+o*o);if(a<i.radius+e.radius){const{circle1:t,circle2:s}=d({x:i.x,y:i.y,radius:i.radius},{x:e.x,y:e.y,radius:e.radius}),n=h/a,r=o/a,l=i.vel.x,c=i.vel.y,u=e.vel.x,p=e.vel.y,g=(u-l)*n+(p-c)*r;if(g<0){const d=.08,x=(i.mass,e.mass,-(1+d)*g/(1/i.mass+1/e.mass)),y=n*x,m=r*x;if(i!==this.draggedCoin){i.x=t.x,i.y=t.y,i.vel.x-=y/i.mass,i.vel.y-=m/i.mass;const s=Math.abs(-o/a*(u-l)+h/a*(p-c));i.rotation+=.01*s}if(e!==this.draggedCoin){e.x=s.x,e.y=s.y,e.vel.x+=y/e.mass,e.vel.y+=m/e.mass;const t=Math.abs(-o/a*(l-u)+h/a*(c-p));e.rotation+=.01*t}}else i!==this.draggedCoin&&(i.x=t.x,i.y=t.y),e!==this.draggedCoin&&(e.x=s.x,e.y=s.y)}}for(const t of this.coins)t.update(0,this.p.width,0,this.p.height)}draw(){for(const t of this.coins)if(t.draw(),this.debugMode){this.p.push(),this.p.noFill(),this.p.stroke(255,0,0,150),this.p.strokeWeight(2),this.p.circle(t.x,t.y,2*t.radius),this.p.stroke(0,255,0,150),this.p.line(t.x-5,t.y,t.x+5,t.y),this.p.line(t.x,t.y-5,t.x,t.y+5);const s=2;this.p.stroke(0,0,255),this.p.strokeWeight(2);const i=t.x+t.vel.x*s,e=t.y+t.vel.y*s;this.p.line(t.x,t.y,i,e);const h=7,o=Math.atan2(t.vel.y,t.vel.x);t.vel.mag()>.01&&(this.p.push(),this.p.translate(i,e),this.p.rotate(o),this.p.fill(0,0,255,200),this.p.triangle(0,0,-h,h/2,-h,-h/2),this.p.pop()),this.p.fill(0,0,255,200),this.p.noStroke(),this.p.textAlign(this.p.CENTER),this.p.textSize(10),this.p.text(`${t.type} ($${t.value.toFixed(2)})`,t.x,t.y-t.radius-5),t.vel.mag()>.01&&(this.p.fill(0,0,255,200),this.p.text(`v: ${t.vel.mag().toFixed(2)}`,t.x,t.y+t.radius+15)),this.p.pop()}if(this.debugMode&&this.draggedCoin){const t=this.draggedCoin.vel,s=t.mag().toFixed(2),i=180*Math.atan2(t.y,t.x)/Math.PI;let e=100;this.p.push(),this.p.fill(40,40,200),this.p.noStroke(),this.p.textSize(16),this.p.textAlign(this.p.LEFT),this.p.text("Dragged Coin Velocity:",20,e),this.p.text(`Speed: ${s} pixels/sec`,20,e+25),this.p.text(`Direction: ${i.toFixed(0)}Â°`,20,e+50),this.p.text(`X: ${t.x.toFixed(2)}, Y: ${t.y.toFixed(2)}`,20,e+75),this.p.pop()}if(this.gameEnded){this.p.fill(0,0,0,200),this.p.rect(0,0,this.p.width,this.p.height),this.p.fill(255),this.p.textSize(32),this.p.textAlign(this.p.CENTER,this.p.CENTER),this.p.text("Game Over!",this.p.width/2,this.p.height/2-50),this.p.textSize(24),this.p.text(`Your count: ${n(this.userGuess)}`,this.p.width/2,this.p.height/2),this.p.text(`Actual total: ${n(this.totalValue)}`,this.p.width/2,this.p.height/2+50);const t=Math.abs(this.userGuess-this.totalValue);t<.01?(this.p.fill(40,200,40),this.p.text("Perfect count! Well done!",this.p.width/2,this.p.height/2+100)):(this.p.fill(200,40,40),this.p.text(`You were off by ${n(t)}. Try again!`,this.p.width/2,this.p.height/2+100))}}checkAnswer(){const t=document.getElementById("user-count");t&&(this.userGuess=parseFloat(t.textContent.replace("$",""))||0);const s=document.getElementById("user-count-text");s&&(this.userGuess=parseFloat(s.value)||0),this.gameEnded=!0,h(n(this.totalValue),!0),console.log(`User guessed: ${n(this.userGuess)}, Actual: ${n(this.totalValue)}`)}handleKeyPressed(){if("r"===this.p.key&&this.draggedCoin&&(this.draggedCoin.rotation+=this.p.PI/4),"f"===this.p.key)if(this.draggedCoin)this.draggedCoin.flip();else for(const t of this.coins)t.flip();if("c"===this.p.key&&this.checkAnswer(),"n"===this.p.key&&this.init(),"d"===this.p.key&&68!==this.p.keyCode&&this.toggleDebugMode(),!this.gameEnded){const t=document.getElementById("user-count");if(t){let s=parseFloat(t.textContent.replace("$",""))||0;this.p.keyCode===this.p.UP_ARROW?s+=.05:this.p.keyCode===this.p.DOWN_ARROW?s=Math.max(0,s-.05):this.p.keyCode===this.p.RIGHT_ARROW?s+=.25:this.p.keyCode===this.p.LEFT_ARROW?s=Math.max(0,s-.25):"1"===this.p.key?s+=1:"2"===this.p.key?s+=2:"q"===this.p.key?s-=1:"w"===this.p.key?s-=2:"d"===this.p.key?s+=.1:"s"===this.p.key&&(s=Math.max(0,s-.1)),s=Math.max(0,s),e(n(s))}}}}new p5((t=>{let e,h;t.preload=()=>{try{h=function(t){const e={image:null,spriteDefinitions:i,isReady:!1};return e.image=t.loadImage(s,(t=>{t.width>0&&t.height>0?(e.isReady=!0,console.log(`Spritesheet loaded: ${t.width}x${t.height}. Using defined sprite details.`)):console.error("Spritesheet loaded but has zero dimensions:",s)}),(t=>{console.error("Failed to load coin spritesheet:",s,t)})),e}(t)}catch(t){console.error("Failed to load coin spritesheet, game cannot start properly.",t)}},t.setup=()=>{const s=document.getElementById("game-canvas"),i=s?s.clientWidth:800;!function(t,s){t.createCanvas(s,600).parent("game-canvas")}(t,i),e=new l(t,h),t.textFont("Arial"),t.textSize(16),window.addEventListener("resize",(()=>{!function(t,s=300,i=4/3){const e=document.getElementById("game-canvas");if(!e)return;let h=Math.max(s,e.offsetWidth),o=h/i;t.resizeCanvas(h,o)}(t,300,i/600),e&&e.handleCanvasResize(t.width,t.height)}))},t.draw=()=>{t.background(240),e.update(),e.draw(),e.gameEnded||(t.fill(80),t.textAlign(t.LEFT,t.TOP),t.text("Click and drag to move coins",10,10),t.text("Press R to rotate selected coin",10,30),t.text("Press F to flip coin(s)",10,50),t.text("Use arrow keys to adjust your count",10,70),t.text("Press C to check your answer",10,90))},t.mousePressed=()=>{e.handleMousePressed()},t.mouseReleased=()=>{e.handleMouseReleased()},t.keyPressed=()=>{e.handleKeyPressed()}}))})();